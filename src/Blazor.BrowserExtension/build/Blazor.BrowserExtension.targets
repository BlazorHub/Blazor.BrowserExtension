<!-- build/Blazor.BrowserExtension.targets -->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <BrowserExtensionAssetsContentsPath>$(MSBuildThisFileDirectory)..\content\BrowserExtensionScripts</BrowserExtensionAssetsContentsPath>
    <BrowserExtensionAssetsTargetPath>$(BrowserExtensionAssetsPath)\BrowserExtensionScripts</BrowserExtensionAssetsTargetPath>
    <BrowserExtensionAssetsOutputPath>$(TargetDir)$(BrowserExtensionAssetsPath)\BrowserExtensionScripts</BrowserExtensionAssetsOutputPath>
  </PropertyGroup>

  <!-- this will add the files to be copied to the output directory during build -->
  <ItemGroup Condition="'$(IncludeBrowserExtensionAssets)' == 'true'">
    <None Include="$(BrowserExtensionAssetsContentsPath)\Core.js" Link="$(BrowserExtensionAssetsTargetPath)\Core.js">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
    <None Include="$(BrowserExtensionAssetsContentsPath)\Background.js" Link="$(BrowserExtensionAssetsTargetPath)\Background.js">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
    <None Include="$(BrowserExtensionAssetsContentsPath)\ContentScript.js" Link="$(BrowserExtensionAssetsTargetPath)\ContentScript.js">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
    <None Include="$(BrowserExtensionAssetsContentsPath)\lib\browser-polyfill.js" Link="$(BrowserExtensionAssetsTargetPath)\lib\browser-polyfill.js">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
    <None Include="$(BrowserExtensionAssetsContentsPath)\lib\browser-polyfill.js.map" Link="$(BrowserExtensionAssetsTargetPath)\lib\browser-polyfill.js.map">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
    <None Include="$(BrowserExtensionAssetsContentsPath)\lib\browser-polyfill.min.js" Link="$(BrowserExtensionAssetsTargetPath)\lib\browser-polyfill.min.js">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
    <None Include="$(BrowserExtensionAssetsContentsPath)\lib\browser-polyfill.min.js.map" Link="$(BrowserExtensionAssetsTargetPath)\lib\browser-polyfill.min.js.map">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
  </ItemGroup>

  <!-- this will automatically run before the 'RunBuildBlazorToBrowserExtension' target defined in Blazor.BrowserExtension.Build package -->
  <Target Name="RunTokenReplacementToBrowserExtension" BeforeTargets="RunBuildBlazorToBrowserExtension" Condition="'$(BuildBlazorToBrowserExtension)' == 'true'">

    <Message Importance="high" Text="Replacing content of core Blazor.BrowserExtension *.js files" />
    <ItemGroup>
      <BrowserExtensionAssetsOutputJsFiles Include="$(BrowserExtensionAssetsOutputPath)\*.js" />
    </ItemGroup>
	<BlazorToBrowserExtensionSafeNamespace Input="$(ProjectName)" Replacement="_">
      <Output TaskParameter="Output" PropertyName="BlazorProjectSafeProjectName" />
	</BlazorToBrowserExtensionSafeNamespace>
    <ItemGroup>
      <BrowserExtensionReplaceAssetsOutputJsFilesContents Include="Global variable BlazorBrowserExtension">
        <From>__ProjectName__</From>
        <To>$(BlazorProjectSafeProjectName)</To>
      </BrowserExtensionReplaceAssetsOutputJsFilesContents>
    </ItemGroup>
    <BlazorToBrowserExtensionReplaceContent Files="@(BrowserExtensionAssetsOutputJsFiles)" Replace="@(BrowserExtensionReplaceAssetsOutputJsFilesContents)" FailOnWarning="true" FailMessage="Clean the project before build" />

  </Target>

</Project>